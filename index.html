<!DOCTYPE HTML>
<html ng-app="myApp">

<head>
	<meta charset="utf-8">
	<title>Bill2Mobile</title>


	<!-- web app /-->
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="apple-mobile-web-app-capable" content="yes" />
	<meta name="mobile-web-app-capable" content="yes" />
	<meta name="apple-mobile-web-app-status-bar-style" content="black" />
	<link rel="shortcut icon" sizes="196x196" href="icon-196x196.png">
	<link rel="apple-touch-icon" sizes="196x196" href="icon-196x196.png">

	<!-- link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.css" /-->
	<!-- script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.4.1/jquery.mobile-1.4.1.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.2.6/angular.js"></script>
	<script src="http://cdn.jsdelivr.net/restangular/latest/restangular.min.js"></script>
	<script src="http://cdn.jsdelivr.net/lodash/2.1.0/lodash.compat.min.js"></script>
<script src="cordova.js"></script /-->
	<link rel="stylesheet" href="js/vendor/jquery.mobile-1.4.1.min.css" />
	<script src="js/vendor/jquery-1.9.1.min.js"></script>
	<script src="js/vendor/jquery.mobile-1.4.1.min.js"></script>
	<script src="js/vendor/angular.js"></script>
	<script src="js/vendor/restangular.min.js"></script>
	<script src="js/vendor/lodash.compat.min.js"></script>

</head>

<body>
	<div ng-controller="sessionController as sc">
		<div data-role="page" id="login" data-url="login" data-theme="a" ng-controller="loginController">

			<div data-role="content">
				<div data-theme="a" data-form="ui-body-a" class="ui-body ui-body-a ui-corner-all" id="credentials">
					<p>Login:
						<input type="text" ng-model="username"></input>
					</p>
					<p>Password:
						<input type="password" ng-model="password"></input>
					</p>
					<a ng-click="login()" ng-href="#account" data-role="button" data-icon="arrow-r">Login</a>
				</div>
			</div>
			<div id="request">Request:
				<br/>{{request}}
			</div>
			<div id="response">Response:
				<br/>{{response}}
			</div>

		</div>
		<div data-role="page" id="account" data-url="account" data-theme="a" ng-controller="accountController">

			<div data-role="header" data-position="fixed">
				<div data-role="navbar">
					<ul>
						<li>
							<button data-inline="true">Kontoliste</button>
						</li>
						<li>Kunde {{account.account_number}}</li>
						<li>bloom</li>
					</ul>
				</div>
			</div>

		<div data-role="content">

			<p>Rechnungsadresse</p>
			<div data-theme="a" data-form="ui-body-a" class="ui-body ui-body-a ui-corner-all" id="BillAddress">
				<p>{{ account.bill_title }} {{ account.bill_fname }} {{ account.bill_lname }}</p>
				<p>{{ account.bill_address1 }}</p>
				<p>{{ account.bill_address2 }}</p>
				<p>{{ account.bill_address3 }}</p>
				<p>{{ account.bill_zip }} {{ account.bill_city }}</p>
			</div>


			<p>Rechnungssaldo</p>
			<div data-theme="a" data-form="ui-body-a" class="ui-body ui-body-a ui-corner-all" id="BillTotal">
				Offener Gesamtbetrag {{account.open_balance}} {{account.currency}}
				<div class="ui-nodisc-icon ">
					<a href="#" class="ui-btn ui-shadow ui-corner-all ui-icon-info ui-btn-icon-notext ui-btn-inline">Info</a>
				</div>
			</div>

			<p>Laufende Kosten</p>
			<ul data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
				<li>
					<a href="#">Nutzungsgeb√ºhren  {{account.unbilled_usage}} {{account.currency}}</a>
				</li>
			</ul>

			<p>Rechnungen</p>


			<ul data-role="listview" data-inset="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">
				<li ng-repeat="invoice in invoices">
					<a href="#">Rechnungsdatum: {{invoice.statementDate2}}
	Rechnungsbetrag:					{{invoice.balanceDue}} CHF
	Zahlbar bis: 					{{invoice.dueDate}}</a>
				</li>
			</ul>



			<div id="cred">{{username}}:{{password}}</div>
			<div id="request">Request:
				<br/>{{request}}
			</div>
			<div id="response">Response:
				<br/>{{response}}
			</div>
			</div>

			<div data-role="footer" data-position="fixed">
				<div data-role="navbar">
					<ul>
						<li><a href "#">Meine Rechnung</a>
						</li>
						<li><a href "#">Einstellung</a>
						</li>
						<li><a href "#">Hilfe</a>
						</li>
					</ul>
				</div>
			</div>
		</div>
</div>
		<script type="text/javascript">
			var app = angular.module('myApp', []);
			app.controller('sessionController', function($scope, $http) {});
			app.controller('loginController', function($scope, $http) {

				$scope.login = function() {
					var request = {
						language: 'en',
						login: {
							username: $scope.username,
							password: $scope.password
						},
						version: '1.1.7'
					};

					$scope.request = JSON.stringify(request);
					$scope.$parent.request = $scope.request;

					$http({
						method: 'PUT',
						url: 'https://bill2mobile.upc.ch:443/bill2mobileserver/resources/getCustomer',
						data: request
					}).
					success(function(data, status, headers, config) {
						// this callback will be called asynchronously
						// when the response is available

						$scope.response = JSON.stringify(data);
						$scope.$parent.response = $scope.response;
						var myaccount = angular.isDefined(data.customer) ? data.customer.accounts[0] : {};
						$scope.$parent.account = {
							account_number: myaccount.id,
							currency: "CHF",
							bill_lname: myaccount.lastName,
							bill_fname: myaccount.firstName,
							bill_title: myaccount.title,
							bill_address1: myaccount.address,
							bill_address2: "",
							bill_address3: "",
							bill_zip: myaccount.zip,
							bill_city: myaccount.city,
							open_balance: myaccount.balanceDue,
							unbilled_usage: myaccount.unbilledDue
						};
						$scope.$parent.invoices = myaccount.invoices;

					}).
					error(function(data, status, headers, config) {
						// called asynchronously if an error occurs
						// or server returns response with an error status.
						$scope.response = JSON.stringify(data);
					});

				};
			});
			app.controller('accountController', function($scope) {

			});
		</script>
</body>

</html>
